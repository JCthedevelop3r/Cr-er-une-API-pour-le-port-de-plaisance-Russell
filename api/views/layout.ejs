<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API Port de Plaisance Russell</title>
    <link rel="stylesheet" href="/stylesheets/style.css" />
  </head>
  <body>
    <header>
      <div class="left-part-header-container">
        <a href="/dashboard">
          <p>Port de plaisance Russell</p>
        </a>
      </div>
      <div class="right-part-header-container">
        <nav>
          <button>Réservations</button>
          <div class="dropdown-content">
            <% catwaysWithReservations.forEach(catway => { %>
            <a href="/catways/<%= catway.catwayNumber %>/reservations">
              Catway <%= catway.catwayNumber %>
            </a>
            <% }) %>
          </div>
          <a href="/catways">Catways</a>
          <a href="/dashboard">Tableau de bord</a>
        </nav>
      </div>
    </header>

    <main>
      <%- body %>
      <!-- C'est ici que le contenu de la page spécifique sera injecté -->
    </main>

    <footer>
      <p>Port de plaisance Russell</p>
    </footer>

    <script>
      // getNextCatwayNumber
      document.addEventListener("DOMContentLoaded", function () {
        // Vérifie si l'URL contient "/dashboard"
        if (window.location.pathname === "/dashboard") {
          // Fonction pour récupérer dynamiquement le numéro de catway
          window.onload = async function () {
            try {
              const response = await fetch("/dashboard/next-catway-number");
              const data = await response.json();
              document.getElementById("catwayNumberCc").value =
                data.nextCatwayNumber;
            } catch (error) {
              console.error(
                "Erreur lors de la récupération du numéro de catway :",
                error
              );
            }
          };
        }
      });

      // displayCatwayDetails
      document.addEventListener("DOMContentLoaded", function () {
        // Vérifie si l'URL contient "/dashboard"
        if (window.location.pathname === "/dashboard") {
          const catwayNumberDropdown =
            document.getElementById("catwayNumberDcd");

          if (catwayNumberDropdown) {
            catwayNumberDropdown.addEventListener("change", function () {
              const catwayNumber = this.value;

              fetch(
                `/dashboard/catway-details/${encodeURIComponent(catwayNumber)}`
              )
                .then((response) => response.json())
                .then((data) => {
                  if (data.error) {
                    document.getElementById("catwayTypeDcd").innerText =
                      "Non trouvé";
                    document.getElementById("catwayStateDcd").innerText = "";
                  } else {
                    document.getElementById("catwayTypeDcd").innerText =
                      data.type;
                    document.getElementById("catwayStateDcd").innerText =
                      data.catwayState;
                  }
                })
                .catch((error) =>
                  console.error("Erreur récupération catway:", error)
                );
            });
          } else {
            console.warn(
              "L'élément #catwayNumberDcd n'existe pas sur cette page."
            );
          }
        }
      });

      // DisplayReservationDetails
      document.addEventListener("DOMContentLoaded", function () {
        // Vérifie si l'URL contient "/dashboard"
        if (window.location.pathname === "/dashboard") {
          const reservationDropdown =
            document.getElementById("reservationIdDrd");

          if (reservationDropdown) {
            reservationDropdown.addEventListener("change", async function () {
              const reservationId = this.value;

              if (reservationId) {
                try {
                  const response = await fetch(
                    `/dashboard/reservation-details/${reservationId}`
                  );
                  const data = await response.json();

                  document.getElementById("catwayNumberDrd").textContent =
                    data.catwayNumber;
                  document.getElementById("clientNameDrd").textContent =
                    data.clientName;
                  document.getElementById("boatNameDrd").textContent =
                    data.boatName;
                  document.getElementById("checkInDrd").textContent = new Date(
                    data.checkIn
                  ).toLocaleDateString("fr-FR");
                  document.getElementById("checkOutDrd").textContent = new Date(
                    data.checkOut
                  ).toLocaleDateString("fr-FR");
                } catch (error) {
                  console.error(
                    "Erreur lors de la récupération des détails de la réservation",
                    error
                  );
                }
              }
            });
          } else {
            console.warn(
              "L'élément #reservationIdDrd n'existe pas sur cette page."
            );
          }
        }
      });
    </script>
  </body>
</html>
